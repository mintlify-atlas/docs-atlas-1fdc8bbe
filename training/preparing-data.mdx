---
title: Preparing data
description: Learn how to prepare the MNIST dataset for training the neural network, including CSV format requirements and normalization techniques.
---

The neural network expects MNIST data in CSV format with properly normalized pixel values. This guide covers the data structure and preprocessing steps required before training.

## Dataset format

The MNIST dataset should be organized in CSV files with the following structure:

- **First column**: The digit label (0-9)
- **Remaining 784 columns**: Pixel values (28 x 28 image flattened)
- **Pixel values**: Raw grayscale values ranging from 0-255

### File locations

Place your MNIST dataset files in the following locations:

```
mnist_dataset/
├── mnist_train.csv  # Training data (60,000 samples)
└── mnist_test.csv   # Test data (10,000 samples)
```

<Note>
The code expects these exact file paths. Make sure to create the `mnist_dataset` directory in your project root before training.
</Note>

## Data normalization

Raw pixel values must be normalized before feeding them to the neural network. The normalization process scales values to a range suitable for the sigmoid activation function.

### Normalization formula

The implementation uses the following normalization formula:

```go
normalizedValue = (pixelValue / 255.0 * 0.99) + 0.01
```

This formula:
1. Divides by 255.0 to scale values to [0, 1]
2. Multiplies by 0.99 to scale to [0, 0.99]
3. Adds 0.01 to shift the range to [0.01, 1.0]

<Warning>
Avoiding exact 0.0 and 1.0 values prevents numerical issues with the sigmoid function and helps with gradient flow during backpropagation.
</Warning>

### Implementation details

Here's how the normalization is applied in the training code (cmd/main.go:67-71):

```go
inputs := make([]float64, net.Inputs)
for i := range inputs {
    x, _ := strconv.ParseFloat(record[i], 64)
    inputs[i] = (x / 255.0 * 0.99) + 0.01
}
```

## Target encoding

Target labels are encoded using one-hot encoding with adjusted values:

<Steps>

### Create output vector

Initialize a 10-element array (one for each digit 0-9).

### Set default values

Set all positions to 0.01 (low confidence).

### Mark correct digit

Set the position corresponding to the actual digit to 0.99 (high confidence).

</Steps>

### Example encoding

For the digit "3":

```go
targets := []float64{0.01, 0.01, 0.01, 0.99, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01}
//                    0     1     2     3     4     5     6     7     8     9
```

Implementation from cmd/main.go:73-78:

```go
targets := make([]float64, 10)
for i := range targets {
    targets[i] = 0.01
}
x, _ := strconv.Atoi(record[0])
targets[x] = 0.99
```

## Reading CSV data

The training process reads CSV data sequentially using Go's standard library:

```go
testFile, _ := os.Open("mnist_dataset/mnist_train.csv")
r := csv.NewReader(bufio.NewReader(testFile))
for {
    record, err := r.Read()
    if err == io.EOF {
        break
    }
    // Process record...
}
testFile.Close()
```

<Note>
Each record contains 785 values: 1 label + 784 pixel values. The label is in `record[0]`, and pixels start from `record[0]` through `record[783]`.
</Note>

## Image preprocessing for predictions

When predicting from PNG images, the preprocessing is slightly different:

1. **Convert to grayscale**: RGB images are converted to grayscale
2. **Invert colors**: Pixel values are inverted (255 - pixel) to match MNIST format
3. **Apply normalization**: Same formula as training data

From cmd/main.go:199-201:

```go
for i := 0; i < len(gray.Pix); i++ {
    pixels[i] = (float64(255-gray.Pix[i]) / 255.0 * 0.99) + 0.01
}
```

<Warning>
MNIST digits are white on black background. If your images have black digits on white background, the color inversion step is essential for accurate predictions.
</Warning>

## Summary

Key points for data preparation:

- Store MNIST data in CSV format with label in first column
- Normalize pixel values to [0.01, 1.0] range using the specific formula
- Encode target labels with one-hot encoding using 0.01 and 0.99 values
- For custom images, ensure 28x28 PNG format with proper color inversion

Next, learn how to [train the model](/training/training-model) with your prepared dataset.